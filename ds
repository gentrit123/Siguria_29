import random, sys, os, rabinMiller, cryptomath
import xml.etree.ElementTree as xml
import base64
from Crypto.Cipher import DES
import secrets
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP
import string
import getpass
import Crypto
import binascii


##QEKY OSHT NI FUNKSION QE QAT VLER NUMERIKE QE JA JEPUM, PSH VLEREN E QELESIT KY E MERR E E KTHEN "N'base64".
def return_base64(parametri):
  encode_utf8=str(parametri).encode("utf-8")
  b64=base64.b64encode(encode_utf8)
  decode_utf8=b64.decode("utf-8")
  return decode_utf8


#Ky funksion e kthen true ose false varsisht nese ekziston File apo jo, e kqyr edhe nese ekziston ai publik edhe ai privat pastaj i ruan ne nje array.
def isFile(parametri):
  isfile = os.path.isfile("%s.xml" %(parametri))
  isfile_pub = os.path.isfile("%s.pub.xml" %(parametri))
  isfile2 = [isfile, isfile_pub]
  return isfile2


#Ky eshte nje funksion i cili i fshin te dy Filet edhe ata publik te shfrytezuesit edhe ata privat, varsisht nese vlen kushti ne kod.
def remove_2file(parametri):
  os.remove("%s.xml" %(parametri))
  os.remove("%s.pub.xml" %(parametri))
  print("Eshte larguar celesi privat 'keys/%s.xml'" %(parametri))
  print("Eshte larguar celesi publik 'keys/%s.pub.xml'" %(parametri))
            
def remove_2file(parametri):
  os.remove("%s.xml" %(parametri))
  os.remove("%s.pub.xml" %(parametri))
  print("Eshte larguar celesi privat 'keys/%s.xml'" %(parametri))
  print("Eshte larguar celesi publik 'keys/%s.pub.xml'" %(parametri))


#Ky eshte nje funksion i cili nese vlen kushti qe ekziston File i qelsit privat te shfrytezuesit, ky e fshin ate.
def remove_privat_file(parametri):

  f = open("%s.xml" %(parametri), "r")
  content = f.read()
  f.close()
  
  os.remove("%s.xml" %(parametri))

  if (content.find('P') == -1):
    print("Eshte larguar celesi publik 'keys/%s.xml'" %(parametri))
  else: 
    print("Eshte larguar celesi privat 'keys/%s.xml'" %(parametri))


#ky eshte nje funksion i cili nese vlen kushti qe ekzston File i qelsit publik te shfrytezuesit ather e ekzektuojm kete funksion, dhe ky funksion e fshin ate.
def remove_public_file(parametri):
  os.remove("%s.pub.xml" %(parametri))
  print("Eshte larguar celesi publik 'keys/%s.pub.xml'" %(parametri))
        

#ky eshte nje funksion i cili e eksporton qelsin publik te edonit psh tek vlera e parametrt_2 psh genti.xml, nese nuk e kemi japur ate ateher ky e shfaq ate.
def publicKey_export(parametri_1, parametri_2):
  f = open("%s.pub.xml" %(parametri_1))
  content = f.read()
  if parametri_2 !="":
    generate_XML_public(str(parametri_2))
    f1 = open(str(parametri_2), "w+")
    f1.write(str(content))
    f1.close()
    if parametri_2 !="":
      print("Celesi publik u ruajt ne fajllin '%s'" %(parametri_2))
    else:
      print(content)


#Ky eshte nje funksion i cili e eksporton qelsin private te edonit psh tek vlera e parametrit_2 psh genti.xml, nese nuk e kemi japur ate atehere ky e shhfaq ate.
def privateKey_export(parametri_1, parametri_2):
  book = "%s.xml" %(parametri_1)
  f = open(book, "r")
  content = f.read()
  generate_XML_private(str(parametri_2))
  f1 = open(str(parametri_2), "w+")
  f1.write(str(content))
  f1.close()
  if parametri_2 != "":
    print("Celesi privat u ruajt ne fajllin '%s'" %(parametri_2))
  else:
    print(content)
#Funksion i cili i merr veq 4 karakteret e fundit te nje string-u.
def get_last_four_char(parametri):
  last_four_char=parametri[-4:]
  return last_four_char


#Kur ky na kthen si return content, na n qat kontent e kqyrim a ka permbajtje publik apo privat.
def is_content_Priv_or_Pub(parametri):
  book = r"C:\Users\hp\Desktop\%s" %(parametri)
  f = open("%s" %(book), "r")
  content = f.read()

  return content
#Ky funksion perdoret pasi e shikojm qe te import nuk e ka ajo permbajtjen private.
def is_not_Private(parametri_1, parametri_2):
  book1 = r"C:\Users\hp\Desktop\%s" %(parametri_1)
  book = "%s" %(book1)
  f = open(book, "r")
  content = f.read()

  generate_XML_public("%s.pub.xml" %(parametri_2))
  print("Celesi publik u ruajt ne fajllin 'keys/%s.pub.xml'." %(parametri_2))

  f2 = open("%s.pub.xml" %(parametri_2), "w+")
  f2.write(str(content))
  f2.close()
#Pasi e kem perdor kogja shume
def read_files(parametri):
  f = open(book, "r")
  content = f.read()
  return content
            
  #Ky funksion perdore pasi e shikojm qe te import nuk e ka ajo permbajtjne publike.
def is_not_Public(parametri_1, parametri_2):
  try:
    a = isFile(parametri_2)
    if isFile[1] == True:
      print("Gabim: Celesi '%s' ekziston paraprakisht." %(parametri_2))
      sys.exit(1)
    else:

      book1 = r"C:\Users\hp\Desktop\%s" %(parametri_1)
      book = "%s" %(book1)

      f = open(book, "r")
      content = f.read()

      aname_ = b[-20:]          
    
   if (aname == "some_private_key.xml"):
        book1_=r"C:\Users\hp\Desktop\arbnorit_mja_kallxu\some_public_key.xml"
        book_ = "%s" %(book1_)

        f2 = open(book, "r")
        content2 = f2.read()

        generate_XML_public("%s.pub.xml" %(parametri_2))
        generate_XML_private("%s.xml" %(parametri_2))

        print("Celesi privat u ruajt ne fajllin 'keys/%s.xml'." %(parametri_2))
        print("Celesi publik u ruajt ne fajllin 'keys/%s.pub.xml'." %(parametri_2))

        f3 = open("%s.pub.xml" %(name), "w+")
        f3.write(str(content2))
        f3.close()

        book2_ = "%s" %(book1)

        f4 = open(book2_, "r")
        content3 = f4.read()

        f5 = open("%s.xml" %(parametri_2), "w+")
        f5.write(str(content3))
        f5.close()

      else:
        print(error)   




